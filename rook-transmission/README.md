# Rook Transmission SDK

This SDK allows apps to transmit Health Data to the ROOK server.

## Features

* Enqueue and upload health data:
  * Sleep Summary
  * Physical Summary
  * Physical Event
  * Body Summary
  * Blood Glucose Event
  * Blood Pressure Event
  * Body Metrics Event
  * Heart Rate Event
  * Hydration Event
  * Mood Event
  * Nutrition Event
  * Oxygenation Event
  * Stress Event
  * Temperature Event

## Installation

![Maven Central](https://img.shields.io/maven-central/v/com.rookmotion.android/rook-transmission?style=for-the-badge&logo=gradle&label=rook-transmission&color=F44336)
![Maven Central](https://img.shields.io/maven-central/v/com.rookmotion.android/rook-bom?style=for-the-badge&logo=gradle&label=rook-bom&color=F44336)

In your **build.gradle** (app module) add the required dependencies. We recommend using our BoM to get latest compatible
versions:

```groovy
implementation platform("com.rookmotion.android:rook-bom:bom-version")
implementation 'com.rookmotion.android:rook-transmission'
```

## Getting started

To get authorization to use this SDK, you'll need to install and configure
the [rook-auth](https://mvnrepository.com/artifact/com.rookmotion.android/rook-auth) SDK.

### Logging

If you want to see the logs generated by this SDK

When creating an instance of `RookTransmissionManager` provide a logLevel:

```kotlin
RookTransmissionManager(logLevel = "ADVANCED")
```

Available levels:

* "ADVANCED" -> All logs from API. All logs from SDK.
* "BASIC" -> Basic logs from API. All logs from SDK.
* "NONE" -> No logs.

## Usage

Create an instance of `RookTransmissionManager` providing:

* A Context
* An [apiURL](https://docs.tryrook.io/docs/Definitions#api_url) without HTTPS.
* A [userID](https://docs.tryrook.io/docs/Definitions#user_id)
    * The userID must be previously registered
      using the [rook-users](https://mvnrepository.com/artifact/com.rookmotion.android/rook-users) SDK.
* A [clientUUID](https://docs.tryrook.io/docs/Definitions#client_uuid)
* A [clientPassword](https://docsbeta.tryrook.io/docs/Definitions#client_password)

```kotlin
val manager = RookTransmissionManager(
  context,
  "api.rook-connect.dev",
  USER_ID,
  CLIENT_UUID,
  CLIENT_PASSWORD
)
```

### Enqueueing

There are multiple functions to enqueue health data they follow the convention `enqueue_data_type` when calling any of
these functions you'll need to provide an instance of the required data type.

Enqueued data will be stored in an internal database until it is uploaded.

To enqueue a Sleep Summary call `enqueueSleepSummary` and provide an instance of `SleepSummaryItem`:

```kotlin
fun enqueueSleep() {
  scope.launch {
    try {
      val item = SleepSummaryItem(
        sourceOfData = "Health Connect",
        dateTime = dateTime,
        sleepStartDatetime = startDatetime,
        sleepEndDatetime = startDatetime.plusHours(8),
        sleepDate = startDatetime.toLocalDate(),
        sleepDurationSeconds = 64800,
        timeInBedSeconds = 64800,
      )

      manager.enqueueSleepSummary(item)

      // Success
    } catch (e: Exception) {
      // Manage error
    }
  }
}
```

* Remember to send the dates and date times with UTC timezone.

rook_extraction SDKs
like [rook_health_connect](https://mvnrepository.com/artifact/com.rookmotion.android/rook-health-connect)
deliver an already configured `ZonedDateTime` in those cases you don't have to do anything else.

### Clear queue

If you want to clear queued data, so it won't be sent the next time you perform an upload call `clearQueued_data_type`:

```kotlin
fun clearSleepSummaryQueue() {
    scope.launch {
        try {
            manager.clearQueuedSleepSummaries()

            // Success
        } catch (e: Exception) {
            // Manage error
        }
    }
}
```

### Uploading

To upload (send) all enqueued health data call `upload_data_type`, this will upload the desired type of data and
delete them from the Database.

```kotlin
fun uploadAll() {
    scope.launch {
      try {
        manager.uploadSleepSummaries()

        // Success
      } catch (e: Exception) {
        // Manage error
      }
    }
}
```

## Other resources

* See a complete list of `RookTransmissionManager` functions in
  the [Javadoc](https://www.javadoc.io/doc/com.rookmotion.android/rook-transmission/latest/com/rookmotion/rook/transmission/RookTransmissionManager.html)
