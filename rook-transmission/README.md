# Rook Transmission

This SDK allows apps to send health data to RookConnect servers.

## Features

* Send sleep summaries
* Send physical summaries
* Send physical events
* Send body summaries

## Installation

![Maven Central](https://img.shields.io/maven-central/v/com.rookmotion.android/rook-transmission?color=%23F44336)

Add the following to your dependencies (app level build.gradle):

```groovy
implementation 'com.rookmotion.android:rook-transmission:version'
```

## Getting started

To get permission of usage you'll need to install and configure
the [rook-auth](https://mvnrepository.com/artifact/com.rookmotion.android/rook-auth)
SDK.

### Logging

If you want to see the logs generated by this SDK

When creating an instance of `RookTransmissionManager` provide a logLevel:

```kotlin
RookTransmissionManager(logLevel = "ADVANCED")
```

Available levels:

* "ADVANCED" -> All logs from API. All logs from SDK.
* "BASIC" -> Basic logs from API. All logs from SDK.
* "NONE" -> No logs.

## Usage

Create an instance of `RookTransmissionManager` providing a context, a URL without https a userID
and your clientUUID and clientPassword:

```kotlin
val manager = RookTransmissionManager(
    context,
    "api2.rookmotion.review",
    USER_ID,
    CLIENT_UUID,
    CLIENT_PASSWORD
)
```

* userID can be obtained with
  our [rook_users](https://mvnrepository.com/artifact/com.rookmotion.android/rook-users) SDK.

### Enqueueing

There are multiple functions to enqueue health data they follow the convention `enqueue_data_type`
when calling any of these functions you'll need to provide an instance of the required data type.

Enqueued data will be stored in an internal Database until is synced.

To enqueue a Sleep Summary call `enqueueSleepSummary` and provide an instance of `SleepSummaryItem`:

```kotlin
fun enqueueSleep() {
    scope.launch {
        try {
            val item = SleepSummaryItem(
                sourceOfData = "Health Connect",
                dateTime = "2023-01-06T22:00:22.065Z",
                sleepStartDatetime = "2023-01-06T22:00:22.065Z",
                sleepEndDatetime = "2023-01-07T12:00:04.013Z",
                sleepDate = "2023-01-07",
                sleepDurationSeconds = 64800,
                timeInBedSeconds = 64800,
            )

            manager.enqueueSleepSummary(item)

            // Success
        } catch (e: Exception) {
            // Manage error
        }
    }
}
```

Remember to send the dates and date times with ISO-8601 format and UTC timezone. (rook_extraction
SDKs
like [rook_health_connect](https://mvnrepository.com/artifact/com.rookmotion.android/rook-health-connect)
already deliver
the date with ISO-8601 format UTC timezone).

### Clear queue

If you want to clear queued data so it won't be send the next time you perform a sync
call `clearQueued_data_type`:

```kotlin
fun clearSleepSummaryQueue() {
    scope.launch {
        try {
            manager.clearQueuedSleepSummaries()

            // Success
        } catch (e: Exception) {
            // Manage error
        }
    }
}
```

### Syncing

To sync (send) all enqueued health data call `syncAll`, this will sync all types of data and delete
them from the internal Database.

```kotlin
fun syncAll() {
    scope.launch {
        try {
            manager.syncAll()

            // Success
        } catch (e: Exception) {
            // Manage error
        }
    }
}
```

* You can also sync specific types of data these functions will follow the convention:
  `sync_data_type`.