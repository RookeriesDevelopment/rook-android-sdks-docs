# Rook Transmission SDK

This SDK allows apps to transmit Health Data to the ROOK server.

## Features

* Enqueue and upload health data:
    * Sleep Summary
    * Physical Summary
    * Physical Event
    * Body Summary
    * Blood Glucose Event
    * Blood Pressure Event
    * Body Metrics Event
    * Heart Rate Event
    * Hydration Event
    * Mood Event
    * Nutrition Event
    * Oxygenation Event
    * Stress Event
    * Temperature Event

## Installation

![Maven Central](https://img.shields.io/maven-central/v/com.rookmotion.android/rook-transmission?style=for-the-badge&logo=gradle&label=rook-transmission&color=7200F7)
![Maven Central](https://img.shields.io/maven-central/v/com.rookmotion.android/rook-bom?style=for-the-badge&logo=gradle&label=rook-bom&color=7200F7)

In your **build.gradle** (app module) add the required dependencies. We recommend using our BoM to get latest compatible
versions:

```groovy
implementation platform("com.rookmotion.android:rook-bom:bom-version")
implementation 'com.rookmotion.android:rook-transmission'
```

## Getting started

To get authorization to use this SDK, you'll need to install and configure
the [rook-auth](https://mvnrepository.com/artifact/com.rookmotion.android/rook-auth) SDK.

### Environment

The `RookTransmissionEnvironment` enum allows to quickly configure the behaviour of **rook-transmission**, e.g. the api
used to communicate with ROOK servers.

Available environments:

* SANDBOX ➞ Use this during your app development process.
* PRODUCTION ➞ Use this ONLY when your app is published to the PlayStore.

You can use the `BuildConfig.DEBUG` property of you app to configure the environment:

```kotlin
val environment = if (BuildConfig.DEBUG) RookTransmissionEnvironment.SANDBOX
else RookTransmissionEnvironment.PRODUCTION
```

### Logging

If you want to see the logs generated by this SDK pass `enableLogs` as `true` when initialing. You can use
the `BuildConfig.DEBUG` property of you app to configure logging:

```kotlin
val enableLogs = BuildConfig.DEBUG
```

## Usage

### Initialization

To initialize this SDK call `RookTransmissionConfiguration.initRookTransmission` and provide:

* Context
* [clientUUID](https://docs.tryrook.io/docs/Definitions#client_uuid)
* [Environment](#environment)
* [EnableLogs](#logging)

```kotlin
val environment = if (BuildConfig.DEBUG) RookTransmissionEnvironment.SANDBOX
else RookTransmissionEnvironment.PRODUCTION

val enableLogs = BuildConfig.DEBUG

val result = RookTransmissionConfiguration.initRookTransmission(
    context = context,
    clientUUID = clientUUID,
    environment = environment,
    enableLogs = enableLogs,
)

result.fold(
    {
        // Initialized
    },
    {
        val error = "InitializationError: ${it.localizedMessage}"

        // Error initializing
    }
)
```

#### Recommendations

When you call `initRookTransmission` an HTTP request is made, so you should only call it once. We recommend to code this
process in
your application's initialization, e.g. the splash screen.

### RookTransmissionManager

The `RookTransmissionManager` class contains all **rook-transmission** features, to create an instance provide:

* Context
* [UserID](https://docs.tryrook.io/docs/Definitions/#user_id)
* [clientUUID](https://docs.tryrook.io/docs/Definitions#client_uuid)
* [clientPassword](https://docsbeta.tryrook.io/docs/Definitions#client_password)

```kotlin
val rookTransmissionManager = RookTransmissionManager(
    context = context,
    userID = USER_ID,
    clientUUID = CLIENT_UUID,
    clientPassword = CLIENT_PASSWORD,
)
```

### Enqueueing

There are multiple functions to enqueue health data they follow the convention `enqueue_data_type` when calling any of
these functions you'll need to provide an instance of the required data type.

Enqueued data will be stored in an internal database until it is uploaded.

To enqueue a Sleep Summary call `enqueueSleepSummary` and provide an instance of `SleepSummaryItem`:

```kotlin
fun enqueueSleep() {
    scope.launch {
        try {
            val item = SleepSummaryItem(
                sourceOfData = "Health Connect",
                dateTime = dateTime,
                sleepStartDatetime = startDatetime,
                sleepEndDatetime = startDatetime.plusHours(8),
                sleepDate = startDatetime.toLocalDate(),
                sleepDurationSeconds = 64800,
                timeInBedSeconds = 64800,
            )

            rookTransmissionManager.enqueueSleepSummary(item)

            // Success
        } catch (e: Exception) {
            // Manage error
        }
    }
}
```

* Remember to send the dates and date times with UTC timezone.

rook_extraction SDKs
like [rook_health_connect](https://mvnrepository.com/artifact/com.rookmotion.android/rook-health-connect)
deliver an already configured `ZonedDateTime` in those cases you don't have to do anything else.

### Clear queue

If you want to clear queued data, so it won't be sent the next time you perform an upload call `clearQueued_data_type`:

```kotlin
fun clearSleepSummaryQueue() {
    scope.launch {
        try {
            rookTransmissionManager.clearQueuedSleepSummaries()

            // Success
        } catch (e: Exception) {
            // Manage error
        }
    }
}
```

### Uploading

To upload (send) all enqueued health data call `upload_data_type`, this will upload the desired type of data and
delete them from the Database.

```kotlin
fun uploadAll() {
    scope.launch {
        try {
            rookTransmissionManager.uploadSleepSummaries()

            // Success
        } catch (e: Exception) {
            // Manage error
        }
    }
}
```

### Updating user timezone

To update the timezone information of your users call `uploadUserTimeZone` and provide:

* **timezone** A tz database string describing the area and location, e.g. America/New_York.
* **offset** An integer describing the UTC offset hours, must be in the range of -18 to 18 (inclusive).

**Example using rook-health-connect**

```kotlin
fun updateUserTimeZone() {
    val userTimeZone = rookHealthConnectManager.getUserTimeZone()

    try {
        rookTransmissionManager.uploadUserTimeZone(
            userTimeZone.timezone,
            userTimeZone.offset
        )
        // Success
    } catch (e: Exception) {
        // Manage error
    }
}
```

## Other resources

* See a complete list of `RookTransmissionManager` functions in
  the [Javadoc](https://www.javadoc.io/doc/com.rookmotion.android/rook-transmission/latest/com/rookmotion/rook/transmission/RookTransmissionManager.html)
