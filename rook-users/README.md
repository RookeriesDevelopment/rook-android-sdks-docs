# Rook Users SDK

This SDK allows [clients](https://docs.tryrook.io/docs/Definitions/#client) to register
their [Users](https://docs.tryrook.io/docs/Definitions/#User) in ROOK server.

## Features

* Register users in Health Connect

## Installation

![Maven Central](https://img.shields.io/maven-central/v/com.rookmotion.android/rook-users?style=for-the-badge&logo=gradle&label=rook-users&color=7200F7)
![Maven Central](https://img.shields.io/maven-central/v/com.rookmotion.android/rook-bom?style=for-the-badge&logo=gradle&label=rook-bom&color=7200F7)

In your **build.gradle** (app module) add the required dependencies. We recommend using our BoM to get latest compatible
versions:

```groovy
implementation platform("com.rookmotion.android:rook-bom:bom-version")
implementation 'com.rookmotion.android:rook-users'
```

Add the following to your dependencies (app level build.gradle):

```groovy
implementation 'com.rookmotion.android:rook-users:version'
```

## Getting started

To get authorization to use this SDK, you'll need to install and configure
the [rook-auth](https://mvnrepository.com/artifact/com.rookmotion.android/rook-auth) SDK.

### Environment

The `RookUsersEnvironment` enum allows to quickly configure the behaviour of **rook-users**, e.g. the api
used to communicate with ROOK servers.

Available environments:

* SANDBOX ➞ Use this during your app development process.
* PRODUCTION ➞ Use this ONLY when your app is published to the PlayStore.

You can use the `BuildConfig.DEBUG` property of you app to configure the environment:

```kotlin
val rookUsersManager: RookUsersManager by lazy {
    if (BuildConfig.DEBUG) {
        RookUsersManager(
            context = context,
            clientUUID = CLIENT_UUID,
            clientPassword = CLIENT_PASSWORD,
            environment = RookUsersEnvironment.SANDBOX,
            logLevel = "ADVANCED"
        )
    } else {
        RookUsersManager(
            context = context,
            clientUUID = CLIENT_UUID,
            clientPassword = CLIENT_PASSWORD,
            environment = RookUsersEnvironment.PRODUCTION,
        )
    }
}
```

### Logging

If you want to see the logs generated by this SDK

When creating an instance of `RookUsersManager` provide a logLevel:

```kotlin
RookUsersManager(logLevel = "ADVANCED")
```

Available levels:

* "ADVANCED" -> All logs from API. All logs from SDK.
* "BASIC" -> Basic logs from API. All logs from SDK.
* "NONE" -> No logs.

## Usage

### Authorization

To get permission of usage call `RookUsersAuthorization.authorize` and provide:

* Context
* [clientUUID](https://docs.tryrook.io/docs/Definitions#client_uuid)

```kotlin
val result = RookUsersAuthorization.authorize(context, clientUUID)

result.fold(
    {
        // Authorized
    },
    {
        val error = "AuthorizationError: ${it.localizedMessage}"

        // Error authorizing
    }
)
```

#### Recommendations

When you call `authorize` an HTTP request is made, so you should only call it once. We recommend to code this process in
your application's initialization, e.g. the splash screen.

### RookUsersManager

The `RookUsersManager` class contains all **rook-users** features, to create an instance provide:

* Context
* [clientUUID](https://docs.tryrook.io/docs/Definitions#client_uuid)
* [clientPassword](https://docsbeta.tryrook.io/docs/Definitions#client_password)
* [Environment](#environment)
* [LogLevel](#logging)

```kotlin
val rookUsersManager = RookUsersManager(
    context = context,
    clientUUID = CLIENT_UUID,
    clientPassword = CLIENT_PASSWORD,
    environment = RookUsersEnvironment.SANDBOX,
    logLevel = "ADVANCED"
)
```

### Registering Users

To register a user call `registerRookUser` providing a userID and a userType. It
will return an instance of `RookUser`. After a successful registration it will store a `RookUser`
instance in preferences so the next time you call `registerRookUser` the local value will be
returned. Unless you provide a different userID, in that case it will behave like the first time.

The `userID` is defined by you, so feel free to use the same ID your app uses to identify it's
users. If you provide an ID which is already exists in the server it will only store it in
preferences.

The `userType` determines where the user will be created. E.g. if you want to create a user for
Health Connect use `UserType.HEALTH_CONNECT`:

```kotlin
fun registerUser() {
    scope.launch {
        try {
            val result = rookUsersManager.registerRookUser(USER_ID, UserType.HEALTH_CONNECT)

            // Success
        } catch (e: Exception) {
            // Manage error
        }
    }
}
```

### Removing registered users from preferences

This SDK already manages the case were you need to register a different userID (the new userID
will replace the previous one in preferences).

If you want to manually remove a userID call `removeUserFromPreferences` and provide the type of
user you want to remove it will return a boolean indicating if the operation was successful.

```kotlin
fun remove() {
    scope.launch {
        try {
            val result = rookUsersManager.removeUserFromPreferences(UserType.HEALTH_CONNECT)

            // Success
        } catch (e: Exception) {
            // Manage error
        }
    }
}
```

* `removeUserFromPreferences` will only delete from local storage, the user will remain registered
  on server.

## Additional information

The first time your users use this SDK they MUST have an active internet connection otherwise
the request will fail and the userID won't be registered or stored.
