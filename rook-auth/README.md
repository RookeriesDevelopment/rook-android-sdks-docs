# Rook authorization SDK

This is the main SDK required by all rook SDKs to enable their usage.

## Features

* Obtain and save authorization to use other rook SDKs with your client UUID.

## Installation

![Maven Central](https://img.shields.io/maven-central/v/com.rookmotion.android/rook-auth?style=for-the-badge&logo=gradle&label=rook-auth&color=F44336)
![Maven Central](https://img.shields.io/maven-central/v/com.rookmotion.android/rook-bom?style=for-the-badge&logo=gradle&label=rook-bom&color=F44336)

In your **build.gradle** (app module) add the required dependencies. We recommend using our BoM to get latest compatible
versions:

```groovy
implementation platform("com.rookmotion.android:rook-bom:bom-version")
implementation 'com.rookmotion.android:rook-auth'
```

## Getting started

### Logging

If you want to see the logs generated by this SDK

When creating an instance of `AuthorizationProvider` provide a logLevel:

```kotlin
AuthorizationProvider(logLevel = "ADVANCED")
```

Available levels:

* "ADVANCED" -> All logs from API. All logs from SDK.
* "BASIC" -> Basic logs from API. All logs from SDK.
* "NONE" -> No logs.

## Usage

You must check authorization every time your app starts or before using other rook SDKs.

Create an instance of `AuthorizationProvider` providing a context, and apiUrl without https.

```kotlin
val provider = AuthorizationProvider(context, "api.rook-connect.dev")
```

Call `getAuthorization` providing your client UUID, this will ask the server for a token which
contains the SDKs you are allowed to use, and save this information in the device's local
preferences.

```kotlin
fun getAuthorization() {
    scope.launch {
        try {
            val result = provider.getAuthorization(CLIENT_UUID)

            // Success
        } catch (e: Exception) {
            // Manage error
        }
    }
}
```

This method returns a Future of `AuthorizationResult` described below:

```kotlin
data class AuthorizationResult(
    val origin: AuthorizationOrigin, // Where the authorization was retrieved from.
    val authorization: Authorization // Authorization returned by server/preferences.
)

enum class AuthorizationOrigin {
    REMOTE, // The authorization was retrieved from server.
    LOCAL // The authorization was retrieved from preferences, this happens when the device does not have an active internet connection or if the request to the server fails.
}

data class Authorization(
    val authorizedUntil: ZonedDateTime, // Expire date (UTC).
    val features: Map<Feature, Boolean> // Features (SDKs) that are enabled or disabled.
)
```

## Additional information

The first time your users use this SDK they MUST have an active internet connection otherwise
the request will fail and a default authorization will be returned.

* The default authorization has all SDKs disabled.
